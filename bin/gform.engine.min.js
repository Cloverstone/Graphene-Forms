var gform=function(t,e){"use strict";this.methods=t.methods||{},this.eventBus=new gform.eventBus({owner:"form",item:"field",handlers:t.events||{}},this),this.on=this.eventBus.on,this.trigger=function(t,e,i){"string"==typeof t&&(t=[t]);var o=_.extend([],t);"object"==typeof e&&_.each(t,(function(t){"-1"==t.indexOf(":")&&o.unshift(t+":"+e.name)})),this.dispatch(_.uniq(o),e,i)}.bind(this),this.dispatch=this.eventBus.dispatch,this.on("reset",(function(t){t.form.set(t.form.options.data)})),this.on("clear",(function(t){t.form.set()})),"object"==typeof t.collections?this.collections=t.collections:this.collections=gform.collections,this.options=_.assignIn({fields:[],legend:"",strict:!0,default:gform.default,data:"search",columns:gform.columns,name:gform.getUID()},this.opts,t),this.options.fields=this.options.fields.concat(this.options.actions),"string"==typeof this.options.data&&(this.options.data=window.location[this.options.data].substr(1).split("&").map((function(t){return t.split("=")})).reduce((function(t,e){return t[e[0]]=decodeURIComponent(e[1]),t}),{})),this.options.sections&&_.each(_.filter(this.options.fields,{type:"fieldset"}),(function(t,e){return t.index=e,t.section=!0,t.id=gform.getUID(),t})),this.el=e||t.el,"string"==typeof this.el?(this.selector=this.el+"",this.el=document.querySelector(this.el)):"object"==typeof this.el?this.el:e="",this.trigger("initialize",this);var i=function(){void 0===this.el&&(this.options.renderer="modal",this.el=gform.create(gform.render(this.options.template||"modal_container",this.options)),gform.addClass(this.el,"active"),this.on("close",(function(t){t.form.modal("hide")})),this.on("save",(function(t){gform.removeClass(t.form.el,"active")})),this.el.querySelector(".close").addEventListener("click",function(t){this.trigger("cancel",this)}.bind(this)),document.addEventListener("keyup",function(t){"Escape"===t.key&&this.trigger("cancel",this)}.bind(this))),this.options.clear&&"modal"!=this.options.renderer&&(this.el.innerHTML=gform.render(this.options.sections+"_container",this.options)),this.container=this.el.querySelector("form")||this.el,this.rows=[],this.fields=_.map(this.options.fields,gform.createField.bind(this,this,this.options.data||{},null,null)),_.each(this.fields,gform.inflate.bind(this,this.options.data||{})),this.reflow(),gform.each.call(this,(function(t){t.owner.trigger("change:"+t.name,t)})),this.options.private||(gform.instances[this.options.name]=this)};this.restore=i.bind(this),this.get=this.toJSON=gform.toJSON.bind(this),this.toString=gform.toString.bind(this),this.reflow=gform.reflow.bind(this),this.find=gform.find.bind(this),this.filter=gform.filter.bind(this),this.set=function(t,e){"string"==typeof t&&this.find(t).set(e),"object"==typeof t&&_.each(t,function(t,e){var i=this.find(e);void 0!==i&&i.set(t)}.bind(this)),null==t&&gform.each.call(this,(function(t){t.set("")}))}.bind(this),this.isActive=!1,this.destroy=function(){this.isActive=!1,this.trigger(["close","destroy"]),this.el.removeEventListener("click",this.listener),this.el.innerHTML="",delete gform.instances[this.options.name],this.trigger("destroyed"),delete this.eventBus},i.call(this);var o=this.el.querySelector("ul.tabs");return null!==o&&o.addEventListener("click",function(t){"LI"==t.target.nodeName&&(t.preventDefault(),gform.removeClass(this.el.querySelector("ul.tabs .active"),"active"),gform.removeClass(this.el.querySelector(".tab-pane.active"),"active"),gform.addClass(t.target,"active"),gform.addClass(this.el.querySelector(t.target.parentElement.attributes.href.value),"active"))}.bind(this)),(this.options.autoFocus||gform.options.autoFocus)&&this.fields.length&&gform.types[this.fields[0].type].focus.call(this.fields[0]),this.listener=function(t){var e;if(t.target.dataset.id&&(e=gform.findByID.call(this,t.target.dataset.id)),t.target.classList.contains("gform-add")){t.stopPropagation();var i=_.filter(e.parent.fields,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})).length;if(e.editable&&i<(e.array.max||5)){var o=_.findIndex(e.parent.fields,{id:e.id}),n={};n[e.name]=[e.item.value||null];var r=gform.createField.call(this,e.parent,n,e.el,null,e.item,null,null,i);e.parent.fields.splice(o+1,0,r),e.operator.reflow(),_.each(_.filter(e.parent.fields,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})),(function(t,e){t.index=e,gform.types[t.type].setLabel.call(t)})),gform.each.call(e.owner,(function(t){t.owner.trigger("change:"+t.name,t)})),gform.types[r.type].focus.call(r),e.parent.trigger(["change","input","create","inserted"],e),i++}var s=function(t,e){gform.toggleClass(e,"hidden",t)};_.each(e.operator.el.querySelectorAll('[data-name="'+e.name+'"] .gform-add'),s.bind(null,i>=(e.array.max||5))),_.each(e.operator.el.querySelectorAll('[data-name="'+e.name+'"] .gform-minus'),s.bind(null,!(i>(e.array.min||1))))}if(t.target.classList.contains("gform-minus")){t.stopPropagation();i=_.filter(e.parent.fields,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})).length;if(e.editable&&i>(e.array.min||1)){o=_.findIndex(e.parent.fields,{id:e.id});e.parent.fields.splice(o,1),e.operator.reflow(),_.each(_.filter(e.parent.fields,(function(t){return t.name==e.name&&void 0!==t.array&&!!t.array})),(function(t,e){t.index=e,gform.types[t.type].setLabel.call(t)})),e.parent.trigger(["change","input","removed"],e),i--}else e.editable&&e.set(null);s=function(t,e){gform.toggleClass(e,"hidden",t)};_.each(e.operator.el.querySelectorAll('[data-name="'+e.name+'"] .gform-add'),s.bind(null,i>=(e.array.max||5))),_.each(e.operator.el.querySelectorAll('[data-name="'+e.name+'"] .gform-minus'),s.bind(null,!(i>(e.array.min||1))))}}.bind(this),this.el.addEventListener("click",this.listener),this.trigger("initialized",this),this.isActive=!0,this.reflow(),this};gform.each=function(t){_.each(this.fields,(function(e){t(e),void 0!==e.fields&&gform.each.call(e,t)}))},gform.find=function(t){var e,i;if("string"==typeof t)e=t.split("."),i=_.find(this.fields,{name:e.shift()});else if("number"==typeof t);else if("object"==typeof t)return gform.filter.call(this,t)[0]||!1;return void 0!==i?void 0!==i.find?i.name==t||"number"==typeof t?i:i.find(e.join(".")):i:void 0!==this.parent&&"function"==typeof this.parent.find?this.parent.find(t):void 0},gform.findByID=function(t){return gform.filter.call(this,{id:t})[0]||!1},gform.filter=function(t){var e=[];return _.each(this.fields,(function(i){_.isMatch(i,t)&&e.push(i),void 0!==i.fields&&(e=e.concat(gform.filter.call(i,t)))})),e},gform.toJSON=function(t){if("string"==typeof t&&t.length>0){t=t.split(".");var e=_.find(this.fields,{name:t.shift()});return void 0!==e?e.get(t.join(".")):void 0}var i={};return _.each(this.fields,function(t){t.parsable&&(t.array?(i[t.name]=i[t.name]||[],Array.isArray(i[t.name])||(i[t.name]=[]),i[t.name].push(t.get())):i[t.name]=t.get())}.bind(this)),i},gform.toString=function(t){if("string"==typeof t&&t.length>0)return t=t.split("."),_.find(this.fields,{name:t.shift()}).toString(t.join("."));var e="";return _.each(this.fields,(function(t){var i=t.toString();e+=i})),e},gform.m=function(t,e,i,o){function n(t,e){return t=t[(e=e.pop?e:e.split(".")).shift()]||"",0 in e?n(t,e):t}var r=gform.m,s="";e=_.isArray(e)?e:e?[e]:[],e=o?0 in e?[]:[1]:e;for(o=0;o<e.length;o++){var a,l="",f=0,d="object"==typeof e[o]?e[o]:{};(d=_.assign({},i,d))[""]={"":e[o]},t.replace(/([\s\S]*?)({{((\/)|(\^)|#)(.*?)}}|$)/g,(function(t,e,i,o,c,p,u){f?l+=f&&!c||1<f?t:e:(s+=e.replace(/{{{(.*?)}}}|{{(!?)(&?)(>?)(.*?)}}/g,(function(t,e,i,o,s,a){return e?n(d,e):o?n(d,a):s?r(n(d,a),d):i?"":new Option(n(d,a)).innerHTML})),a=p),c?--f||(u=n(d,u),s=/^f/.test(typeof u)?s+u.call(d,l,(function(t){return r(t,d)})):s+r(l,u,d,a),l=""):++f}))}return s},gform.instances={},gform.inflate=function(t,e,i,o){var n=o;e.array&&(n=_.filter(n,(function(t){return!t.index})));var r=_.findLast(n,{name:n[i].name});if(!r.array&&r.fields&&(_.each(r.fields,gform.inflate.bind(this,t[r.name]||r.owner.options.data[r.name]||{})),r.reflow()),r.array){var s=r.array.min||0;"object"!=typeof t[r.name]&&"object"==typeof r.owner.options.data[r.name]&&(t=r.owner.options.data),"object"==typeof t[r.name]&&t[r.name].length>1&&t[r.name].length>s&&(s=t[r.name].length);for(var a=_.filter(r.parent.fields,(function(t){return t.name==r.name&&void 0!==t.array&&!!t.array})).length;a<s;a++){var l=gform.createField.call(this,r.parent,t,r.el,a,r.item,null,null,a);r.parent.fields.splice(_.findIndex(r.parent.fields,{id:r.id})+1,0,l),r=l}var f=function(t,e){gform.toggleClass(e,"hidden",t)};_.each(r.operator.el.querySelectorAll('[data-name="'+r.name+'"] .gform-add'),f.bind(null,s>=(r.array.max||5))),_.each(r.operator.el.querySelectorAll('[data-name="'+r.name+'"] .gform-minus'),f.bind(null,!(s>(r.array.min||1))))}},gform.normalizeField=function(t,e){e=e||null;t.type=t.type||this.options.default.type||"text",void 0===gform.types[t.type]&&(console.warn('Field type "'+t.type+'" not supported - using text instead'),t.type="text");var i=_.assignIn({name:(gform.renderString(t.label||t.title)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:t.legend||t.title||(gform.types[t.type]||gform.types.text).defaults.label||t.name,validate:[],valid:!0,parsable:!0,visible:!0,editable:!0,parent:e,array:!1,columns:this.options.columns||gform.columns,offset:this.options.offset||gform.offset||0,ischild:!(e instanceof gform)},this.opts,gform.default,this.options.default,(gform.types[t.type]||gform.types.text).defaults,t);return void 0===i.multiple&&void 0!==i.limit&&i.limit>1&&(i.multiple=!0),""==i.name&&(i.name=i.id),i.item=_.extend(t,{}),i},gform.ajax=function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(200===e.status?t.success(JSON.parse(e.responseText)):(console.log(e.responseText),"function"==typeof t.error&&t.error(e.responseText)))},e.open(t.verb||"GET",t.path),e.send()},gform.default={},gform.options={autoFocus:!0},gform.prototype.opts={actions:[{type:"cancel"},{type:"save"}],clear:!0,sections:"",suffix:":",rowClass:"row",requiredText:'<span style="color:red">*</span>'},gform.eventBus=function(t,e){this.options=t||{owner:"form",item:"field"},this.owner=e||this,this.handlers=_.extend({},t.handlers),_.each(this.handlers,function(t,e,i){"function"==typeof t?i[e]=[t]:"string"==typeof t&&("function"==typeof this[t]?i[e]=[this[t]]:"function"==typeof this.owner[t]?i[e]=[this.owner[t]]:void 0!==this.owner.methods&&"function"==typeof this.owner.methods[t]?i[e]=[this.owner.methods[t]]:"function"==typeof window[t]?i[e]=[window[t]]:i[e]=null)}.bind(this)),this.dispatch=function(t,i,o){(o=o||{})[this.options.owner]=this.owner,void 0!==i&&(o[this.options.item]=i),o.default=!0,o.continue=!0,o.preventDefault=function(){this.a.default=!1}.bind(this),o.stopPropagation=function(){this.a.continue=!1}.bind(this);var n=[];return"string"==typeof t?n.push(t):n=n.concat(t),_.each(n,function(t,i){t.event=i;var n=function(i){o.continue&&i.call(e,t)}.bind(this);_.each(this.handlers[i],n),_.each(this.handlers["*"],n)}.bind(this,o)),o}.bind(this),this.on=function(t,e){var i=t.split(" ");return"object"!=typeof this.handlers[t]&&(this.handlers[t]=[]),_.each(i,function(t){"function"==typeof e?this.handlers[t].push(e):"function"==typeof this[e]&&this.handlers[t].push(this[e])}.bind(this)),this.owner}.bind(this)},gform.mapOptions=function(t,e,i,o){this.collections=o,this.eventBus=new gform.eventBus({owner:"field",item:"option"},this),this.optgroup=_.extend({},t),i=i||0;var n=this.optgroup.format;function r(t){return _.map(t,function(t){if("object"==typeof t&&"optgroup"==t.type)return t.map=new gform.mapOptions(_.extend({format:n},t),e,i,this.collections),t.map.on("*",function(t){this.eventBus.dispatch(t.event)}.bind(this)),t.id=gform.getUID(),gform.processConditions.call(this,t.edit,function(t,e){for(var i=this.el.querySelectorAll('[data-id="'+t+'"]'),o=0;o<i.length;o++)i[o].disabled=!e}.bind(this,t.id)),gform.processConditions.call(this,t.show,function(t,e){for(var i=this.el.querySelectorAll('[data-id="'+t+'"]'),o=0;o<i.length;o++)i[o].hidden=!e}.bind(this,t.id)),i+=t.map.getoptions().length,t;var o=_.extend({},t);return o.data=t,"string"!=typeof t&&"number"!=typeof t&&"boolean"!=typeof t||(o.label=o.value=t),o.index=t.index||""+i,void 0!==n&&(void 0!==n.label&&("string"==typeof n.label?o.label=gform.renderString(n.label,o):"function"==typeof n.label&&(o.label=n.label.call(this.option))),void 0!==n.display&&("string"==typeof n.display?o.display=gform.renderString(n.display,o):"function"==typeof n.display&&(o.display=n.display.call(this.option))),void 0!==n.value&&("string"==typeof n.value?o.value=gform.renderString(n.value,o):"function"==typeof n.value&&(o.value=n.value.call(this,o)))),(o.value==e||void 0!==e&&e.length&&e.indexOf(o.value)>=0)&&(o.selected=!0),i+=1,o.i=i,o}.bind(this))}switch(this.optgroup.options=this.optgroup.options||[],typeof this.optgroup.options){case"string":this.optgroup.path=this.optgroup.path||this.optgroup.options,this.optgroup.options=[];break;case"function":this.optgroup.action=this.optgroup.options,this.optgroup.options=[]}if(void 0!==this.optgroup.max&&""!==this.optgroup.max)for(var s=this.optgroup.min||0;s<=this.optgroup.max;s+=this.optgroup.step||1)this.optgroup.options.push(""+s);return void 0!==this.optgroup.action&&(this.optgroup.options=this.optgroup.options.concat(r.call(this,this.optgroup.action.call(this)))),_.isArray(this.optgroup.options)&&(this.optgroup.options=r.call(this,this.optgroup.options)),void 0!==this.optgroup.path&&(this.collections.on(this.optgroup.path,function(t){this.optgroup.options=r.call(this.optgroup.map,t.collection),this.eventBus.dispatch("change")}.bind(this)),void 0===this.collections.get(this.optgroup.path)?(this.collections.add(this.optgroup.path,[]),gform.ajax({path:this.optgroup.path,success:function(t){this.collections.update(this.optgroup.path,t)}.bind(this)})):this.optgroup.options=r.call(this.optgroup.map,this.collections.get(this.optgroup.path))),{getobject:function(){return _.map(this.optgroup.options,(function(t){return void 0!==t.map?(t.options=t.map.getoptions(),{optgroup:{label:t.label||"",options:t.map.getoptions()}}):t}))}.bind(this),getoptions:function(t){var e=[];return _.each(this.optgroup.options,(function(t){void 0!==t.map?e=e.concat(t.map.getoptions()):e.push(t)})),void 0!==t?_.find(e,t):e}.bind(this),on:this.eventBus.on,handlers:this.handlers,optgroup:this.optgroup}},gform.collectionManager=function(t){var e=t||{};return this.eventBus=new gform.eventBus({owner:"manager",item:"collection",handlers:{}},this),{add:function(t,i){e[t]=i},get:function(t){return e[t]},update:function(t,i){void 0!==i&&(e[t]=i),this.eventBus.dispatch(t,e[t])}.bind(this),on:this.eventBus.on}},gform.collections=new gform.collectionManager,gform.render=function(t,e){return gform.m(gform.stencils[t||"text"]||gform.stencils.text,_.extend({},gform.stencils,e))},gform.create=function(t){return document.createRange().createContextualFragment(t).firstElementChild},gform.renderString=function(t,e){return gform.m(t||"",e||{})},gform.addClass=function(t,e){t.className=_.chain(t.className).split(/[\s]+/).union(e.split(" ")).join(" ").value()},gform.removeClass=function(t,e){t.className=_.chain(t.className).split(/[\s]+/).difference(e.split(" ")).join(" ").value()},gform.toggleClass=function(t,e,i){i?gform.addClass(t,e):gform.removeClass(t,e)},gform.VERSION="0.0.0.9",gform.i=0,gform.getUID=function(){return"f"+gform.i++},gform.about=function(){return _.extend({version:gform.VERSION},gform.THEME,{types:_.keys(gform.types)})},gform.rows={add:function(t){var e=gform.getUID();return cRow={},cRow.used=0,cRow.ref=document.createElement("div"),cRow.ref.setAttribute("id",e),cRow.ref.setAttribute("class",this.options.rowClass),cRow.ref.setAttribute("style","margin-bottom:0;"),t.rows[e]=cRow,t.container.appendChild(cRow.ref),cRow},remove:function(){}},gform.layout=function(t){if(t.columns>0&&t.visible){var e={},i=t.parent.container;if(t.operator=t.parent,"function"==typeof t.item.target&&(t.target=t.item.target.call(t)),"string"==typeof t.target){var o=t.owner.el.querySelector(t.target);null!=o&&(e={target:t.target},i=o,t.operator=t.owner)}var n=_.findLast(t.operator.rows,e);(void 0===n||n.used+parseInt(t.columns,10)+parseInt(t.offset,10)>t.owner.options.columns||1==t.forceRow)&&((n=e).id=gform.getUID(),n.used=0,n.ref=document.createElement("div"),n.ref.setAttribute("id",n.id),n.ref.setAttribute("class",t.owner.options.rowClass),n.ref.setAttribute("style","margin-bottom:0;"),t.operator.rows.push(n),n.container=i,i.appendChild(n.ref)),n.used+=parseInt(t.columns,10),n.used+=parseInt(t.offset,10),n.used,n.ref.appendChild(t.el),t.row=n.id}},gform.createField=function(t,e,i,o,n,r,s,a){var l=gform.normalizeField.call(this,n,t);if(l.owner=this,l.columns>this.options.columns&&(l.columns=this.options.columns),this.options.strict?l.array&&"object"==typeof(e[l.name]||l.owner.options.data[l.name])?l.value=e[l.name]||{}:l.value=_.defaults({value:e[l.name]},l).value:l.array&&"object"==typeof(e[l.name]||l.owner.options.data[l.name])?l.value=(e[l.name]||l.owner.options.data[l.name])[o||0]||{}:l.value=_.defaults({value:e[l.name]},{value:l.owner.options.data[l.name]},l).value,0!==l.item.value?l.array&&"object"==typeof e[l.name]?l.value=e[l.name][o||0]:"function"==typeof l.item.value?(l.valueFunc=l.item.value,l.derivedValue=function(t){return t.field.valueFunc.call(null,t)},delete l.value,l.owner.on("initialized",function(t,e){e.field=t,t.set.call(null,t.derivedValue(e))}.bind(null,l))):"string"==typeof l.item.value&&0===l.item.value.indexOf("=")?(l.derivedValue=function(){var t=this.owner.get();l.formula=gform.renderString(this.item.value.substr(1),t);try{if(l.formula.length&&"undefined"!=typeof math){var e=math.eval(l.formula,t);$.isNumeric(e)&&(l.formula=e.toFixed(this.item.precision||0))}}catch(t){}return l.formula},l.value=l.derivedValue(),l.owner.on("input",function(t){t.set.call(null,t.derivedValue())}.bind(null,l)),l.owner.on("initialized",function(t,e){t.set.call(null,t.derivedValue())}.bind(null,l))):l.value=_.defaults({value:e[l.name]},l,{value:""}).value:l.value=0,l.index=l.index||a||0,l.label=gform.renderString(l.item.label||l.label,l),l.satisfied=l.satisfied||gform.types[l.type].satisfied.bind(l),l.update=gform.types[l.type].update.bind(l),l.destroy=gform.types[l.type].destroy.bind(l),gform.types[l.type].trigger?l.trigger=gform.types[l.type].trigger.bind(l):l.trigger=l.owner.trigger,l.active=function(){return this.parent.active()&&this.editable&&this.parsable&&this.visible},l.set=function(t,e){this.value==t&&null!=t||gform.types[this.type].set.call(this,t)||(this.value=t,e||this.parent.trigger(["change"],this))}.bind(l),l.get=l.get||gform.types[l.type].get.bind(l),l.toString=gform.types[l.type].toString.bind(l),l.render=l.render||gform.types[l.type].render.bind(l),l.el=gform.types[l.type].create.call(l),l.container=l.el.querySelector("fieldset")||l.el||null,void 0!==gform.types[l.type].reflow&&(l.reflow=gform.types[l.type].reflow.bind(l)||null),void 0!==gform.types[l.type].find&&(l.find=gform.types[l.type].find.bind(l)||null),l.section?l.section&&l.owner.el.querySelector("."+l.owner.options.sections+"-content").appendChild(l.el):gform.layout.call(this,l),gform.types[l.type].initialize.call(l),l.fields){var f={};f=l.array&&"object"==typeof(e[l.name]||l.owner.options.data[l.name])?(e[l.name]||l.owner.options.data[l.name])[o||0]||{}:e[l.name]||l.owner.options.data[l.name]||{},l.fields=_.map(l.fields,gform.createField.bind(this,l,f,null,null)),l.array&&(_.each(l.fields,gform.inflate.bind(this,f)),l.reflow())}return gform.processConditions.call(l,l.show,(function(t){var e=this.visible!==t;this.el.style.display=t?"block":"none",this.visible=t,e&&(this.operator.reflow(),this.parent.trigger("change",this))})),gform.processConditions.call(l,l.edit,(function(t){this.editable=t,gform.types[this.type].edit.call(this,this.editable)})),void 0===l.parse&&(l.parse=l.show),gform.processConditions.call(l,l.parse,(function(t){this.parsable=t})),l.required&&gform.processConditions.call(l,l.required,(function(t){this.required!==t&&this.update({required:t})})),l},gform.reflow=function(){(this.isActive||void 0!==this.owner&&this.owner.isActive)&&(_.each(this.rows,function(t,e){void 0!==t&&t.container.removeChild(t.ref)}.bind(this)),this.rows=[],_.each(this.fields,function(t){gform.layout.call(this,t)}.bind(this)))};
gform.types={input:{base:"input",defaults:{},setup:function(){gform.types[this.type].setLabel.call(this)},setLabel:function(){var t=gform.renderString((this.format||{title:null}).title||this.item.title||this.item.label||this.label,this);this.required&&(t+=this.requiredText+this.suffix);var e=this.el.querySelector("label");null!==e&&(e.innerHTML=t)},create:function(){var t=document.createElement("span");return t.setAttribute("id",this.id),t.setAttribute("class",gform.columnClasses[this.columns]+" "+gform.offsetClasses[this.offset]),t.innerHTML=this.render(),t},render:function(){return gform.render(this.type,this)},destroy:function(){this.el.removeEventListener("change",this.onchangeEvent),this.el.removeEventListener("input",this.onchangeEvent)},initialize:function(){this.onchangeEvent=function(t){if(this.value=this.get(),null!=this.el.querySelector(".count")){var e=this.value.length;this.limit>1&&(e+="/"+this.limit),this.el.querySelector(".count").innerHTML=e}gform.types[this.type].setup.call(this),this.parent.trigger(["change"],this,{input:this.value}),t&&this.parent.trigger(["input"],this,{input:this.value})}.bind(this),this.input=this.input||!1,this.el.addEventListener("input",this.onchangeEvent.bind(null,!0)),this.el.addEventListener("change",this.onchangeEvent.bind(null,!1))},update:function(t,e){var i=this.el;void 0===t||void 0===typeof t.options&&void 0===typeof t.max&&void 0===typeof t.action||void 0===this.mapOptions||(delete this.mapOptions,this.item=_.defaults({},t,this.item),this.options=_.extend([],this.item.options),this.max=this.item.max,this.min=this.item.min,this.path=this.item.path,this.action=this.item.action),"object"==typeof t&&(_.extend(this,t),this.item=_.extend(this.item,t)),this.label=gform.renderString((t||{}).label||this.item.label,this),this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),this.el.style.display=this.visible?"block":"none",gform.types[this.type].edit.call(this,this.editable),e||this.parent.trigger(["change"],this),"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},get:function(){return this.el.querySelector('input[name="'+this.name+'"]').value},set:function(t){this.el.querySelector('input[name="'+this.name+'"]').value=t},toString:function(){return"<dt>"+this.label+"</dt> <dd>"+(this.value||"(empty)")+"</dd><hr>"},satisfied:function(t){return null!=(t=t||this.value)&&""!==t&&!("number"==typeof t&&isNaN(t))},edit:function(t){this.el.querySelector('[name="'+this.name+'"]').disabled=!t},find:function(){return this},focus:function(){this.el.querySelector('[name="'+this.name+'"]').focus();var t=this.value;this.set(""),this.set(t)}},bool:{base:"bool",defaults:{options:[!1,!0],format:{label:""}},render:function(){return this.strict||0!=this.options[0]||1!=this.options[1]||(this.value=!!this.value),void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getoptions(),gform.render(this.type,this)},initialize:function(){this.onchangeEvent=function(t){this.value=this.get(),(_.find(this.options,{selected:!0})||{selected:null}).selected=!1,(_.find(this.options,{value:this.value})||this.options[0]||{value:""}).selected=!0,gform.types[this.type].setup.call(this),this.parent.trigger(["change","input"],this,{input:this.value})}.bind(this),this.el.addEventListener("input",this.onchangeEvent.bind(null,!0)),this.el.addEventListener("change",this.onchangeEvent.bind(null,!1))},set:function(t){this.el.querySelector('input[name="'+this.name+'"]').checked=t==this.options[1].value},get:function(){return this.options[this.el.querySelector('input[name="'+this.name+'"]').checked?1:0].value},satisfied:function(t){return(t=t||this.value)==this.options[1].value}},collection:{base:"collection",defaults:{format:{label:"{{{label}}}",value:function(t){return"undefined"!==t.value?t.value:(t.label||t.index).toLowerCase().split(" ").join("_")}}},toString:function(){return this.multiple?this.value.length?_.reduce(this.value,function(t,e){var i=_.find(this.list,{value:e});return void 0!==i&&(t+="<dd>"+i.label+"</dd>"),t}.bind(this),"<dt>"+this.label+"</dt> ")+"<hr>":"<dt>"+this.label+"</dt> <dd>(no selection)</dd><hr>":"<dt>"+this.label+"</dt> <dd>"+((_.find(this.list,{value:this.value})||{label:""}).label||"(no selection)")+"</dd><hr>"},render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),void 0===_.find(this.list,{value:this.value})&&(this.other?this.value="other":this.value=(this.list[0]||{value:""}).value),this.other&&void 0===_.find(this.list,{value:"other"})&&this.options.push({label:"Other",value:"other"}),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0,gform.render(this.type,this)},setup:function(){if(this.multiple&&"undefinded"!=typeof this.limit&&(this.get().length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelector("select").options,(function(t){t.disabled=!t.selected}))):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelector("select").options,(function(t){t.disabled=!1}))),null!=this.el.querySelector(".count"))){var t=this.get().length;this.limit>1&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}gform.types[this.type].setLabel.call(this)},initialize:function(){this.el.addEventListener("change",function(){if(this.value=this.get(),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{selected:null}).selected=!0,null!=this.el.querySelector(".count")){var t=this.value.length;this.limit>1&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}gform.types[this.type].setup.call(this),this.parent.trigger(["change","input"],this,{input:this.value})}.bind(this)),gform.types[this.type].setup.call(this)},get:function(){var t=this.el.querySelector("select").value;if(search=_.find(this.list,{index:t}),t="undefined"==typeof search?this.other?"other":null:search.value,this.multiple){var e=this;t=_.transform(this.el.querySelector("select").options,(function(t,i){if(i.selected){var s=_.find(e.list,{index:i.value});void 0!==s&&t.push(s.value)}}),[])}return t},set:function(t){if(this.el.querySelector("select").value=_.find(this.list,{value:t}).index,this.multiple){if(_.isArray(t)||(t=[t]),"undefinded"!=typeof this.limit&&t.length>this.limit)return!0;_.each(this.el.querySelector("select").options,function(e){e.selected=t.indexOf(e.value)>=0}.bind(this))}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},focus:function(){this.el.querySelector('[name="'+this.name+'"]').focus()},edit:function(t){var e=this.name;this.multiple&&(e+="[]"),this.el.querySelector('[name="'+e+'"]').disabled=!t}},section:{base:"section",setLabel:function(){var t=gform.renderString(this.item.label||this.label,this);this.required&&(t+=this.requiredText+this.suffix);var e=this.el.querySelector("fieldset#"+this.id+">legend");null!==e&&(e.innerHTML=t)},create:function(){var t=document.createRange().createContextualFragment(this.render()).firstElementChild;return gform.addClass(t,gform.columnClasses[this.columns]),gform.addClass(t,gform.offsetClasses[this.offset]),t},initialize:function(){this.rows=[]},render:function(){return this.section?gform.render(this.owner.options.sections+"_fieldset",this):gform.render("_fieldset",this)},update:function(t,e){"object"==typeof t&&_.extend(this.item,t),this.label=gform.renderString((t||{}).label||this.item.label,this);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),this.el.style.display=this.visible?"block":"none",gform.types[this.type].edit.call(this,this.editable),this.container=this.el.querySelector("fieldset")||this.el||null,this.reflow(),e||this.parent.trigger(["change"],this)},get:function(t){return gform.toJSON.call(this,t)},toString:function(t){return"<h4>"+this.label+'</h4><hr><dl style="margin-left:10px">'+gform.toString.call(this,t)+"</dl>"},set:function(t){null==t||""==t?gform.each.call(this,(function(t){t.set("")})):_.each(t,function(t,e){var i=this.find(e);void 0!==i&&i.set(t)}.bind(this))},find:function(t){return gform.find.call(this,t)},reflow:function(){gform.reflow.call(this)},focus:function(){void 0!==this.fields&&this.fields.length&&gform.types[this.fields[0].type].focus.call(this.fields[0])},satisfied:function(t){return null!=(t=t||this.get())&&""!==t&&!("object"==typeof t&&_.isEmpty(t))},trigger:function(t,e,i){"string"==typeof t&&(t=[t]);var s=_.extend([],t);_.each(t,function(t){"-1"==t.indexOf(":")&&s.unshift(t+":"+this.name)}.bind(this)),this.parent.trigger(_.uniq(s),e,i)}},button:{base:"button",toString:function(){return""},defaults:{parsable:!1,columns:2,target:".gform-footer"},create:function(){var t=document.createRange().createContextualFragment(this.render()).firstElementChild;return t.setAttribute("id",this.id),t},initialize:function(){this.action=this.action||(this.label||"").toLowerCase().split(" ").join("_"),this.onclickEvent=function(){this.editable&&this.parent.trigger(this.action,this)}.bind(this),this.el.addEventListener("click",this.onclickEvent)},render:function(){return gform.render("button",this)},satisfied:function(t){return this.editable&&this.visible},update:function(t,e){"object"==typeof t&&_.extend(this,this.item,t),this.label=gform.renderString((t||{}).label||this.item.label,this);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),this.el.style.display=this.visible?"block":"none",gform.types[this.type].edit.call(this,this.editable)},destroy:function(){this.el.removeEventListener("click",this.onclickEvent)},get:function(t){return null},set:function(t){},edit:function(t){this.editable=t,this.el.disabled=!t,gform.toggleClass(this.el,"disabled",!t)},focus:function(){this.el.focus()}}},gform.types.text=gform.types.password=gform.types.color=gform.types.input,gform.types.number=_.extend({},gform.types.input,{get:function(){return parseInt(this.el.querySelector('input[name="'+this.name+'"]').value,10)}}),gform.types.hidden=_.extend({},gform.types.input,{defaults:{columns:!1},toString:function(){return""}}),gform.types.output=_.extend({},gform.types.input,{toString:function(){return""},render:function(){return this.display=gform.renderString((this.format||{}).value||"{{{value}}}",this),gform.render(this.type,this)},get:function(){return this.value},set:function(t){this.value=t,this.display=gform.renderString((this.format||{}).value||"{{{value}}}",this),this.el.querySelector("output").innerHTML=this.display}}),gform.types.email=_.extend({},gform.types.input,{defaults:{validate:[{type:"valid_email"}]}}),gform.types.textarea=_.extend({},gform.types.input,{set:function(t){this.el.querySelector('textarea[name="'+this.name+'"]').value=t},get:function(){return this.el.querySelector('textarea[name="'+this.name+'"]').value}}),gform.types.switch=gform.types.checkbox=_.extend({},gform.types.input,gform.types.bool,{default:{format:{label:""}}}),gform.types.fieldset=_.extend({},gform.types.input,gform.types.section),gform.types.select=_.extend({},gform.types.input,gform.types.collection,{render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),void 0===_.find(this.list,{value:this.value})&&(this.other?this.value="other":this.value=(this.list[0]||{value:""}).value),"string"==typeof this.placeholder&&this.options.unshift({label:this.placeholder,value:"",editable:!1,visible:!1,selected:!0}),this.other&&void 0===_.find(this.list,{value:"other"})&&this.options.push({label:"Other",value:"other"}),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0,gform.render(this.type,this)}}),gform.types.range=_.extend({},gform.types.input,gform.types.collection,{get:function(){return(this.el.querySelector("[type=range]")||{value:""}).value},set:function(t){this.el.querySelector("[type=range]").value=t}}),gform.types.radio=_.extend({},gform.types.input,gform.types.collection,{setup:function(){if(this.multiple&&"undefinded"!=typeof this.limit&&(this.get().length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelectorAll("[type=checkbox]"),(function(t){t.disabled=!t.checked}))):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelectorAll("[type=checkbox]"),(function(t){t.disabled=!1}))),null!=this.el.querySelector(".count"))){var t=this.get().length;this.limit>1&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}gform.types[this.type].setLabel.call(this)},render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getoptions(),this.list=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getoptions(),this.list=this.mapOptions.getoptions(),void 0===_.find(this.list,{value:this.value})&&(this.other?this.value="other":this.value=""),this.other&&void 0===_.find(this.list,{value:"other"})&&this.options.push({label:"Other",value:"other"}),(_.find(this.list,{selected:!0})||{selected:null}).selected=!1,(_.find(this.list,{value:this.value})||{value:""}).selected=!0,gform.render(this.type,this)},get:function(){if(this.multiple){var t=this;return _.transform(this.el.querySelectorAll('[type="checkbox"]:checked'),(function(e,i){e.push(_.find(t.list,{index:i.value}).value)}),[])}return(_.find(this.list,{index:(this.el.querySelector('[type="radio"]:checked')||{value:null}).value})||{value:""}).value},set:function(t){if(this.multiple){if(_.isArray(t)||(t=[t]),"undefinded"!=typeof this.limit&&t.length>this.limit)return!0;_.each(this.el.querySelectorAll("[type=checkbox]"),function(e){e.checked=t.indexOf(e.value)>=0}.bind(this))}else{var e=(_.find(this.list,{value:t})||{index:""}).index,i=this.el.querySelector('[value="'+e+'"]');null!==i&&(i.checked="checked")}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},edit:function(t){_.each(this.el.querySelectorAll("input"),(function(e){e.disabled=!t}))},focus:function(){this.el.querySelector('[type="radio"],[type="checkbox"]').focus()}}),gform.types.scale=_.extend({},gform.types.radio),gform.types.checkboxes=_.extend({},gform.types.radio,{multiple:!0}),gform.types.grid=_.extend({},gform.types.input,gform.types.section,gform.types.collection,{render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value,0,this.owner.collections),this.mapOptions.on("change",function(){this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.list=this.mapOptions.getoptions(),this.fields=_.map(this.fields,(function(t){return _.assignIn({name:(gform.renderString(t.label)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:t.name},t)})),gform.render(this.type,this)},setup:function(){this.multiple&&"undefinded"!=typeof this.limit&&_.each(this.fields,function(t){(this.value[t.name]||[]).length>=this.limit?(t.maxSelected=!0,_.each(this.el.querySelectorAll('[type=checkbox][name="'+t.id+'"]'),(function(t){t.disabled=!t.checked}))):t.maxSelected&&(t.maxSelected=!1,_.each(this.el.querySelectorAll('[type=checkbox][name="'+t.id+'"]'),(function(t){t.disabled=!1})))}.bind(this)),gform.types[this.type].setLabel.call(this)},initialize:function(){this.el.addEventListener("change",function(){this.value=this.get(),gform.types[this.type].setup.call(this),this.parent.trigger(["change","input"],this,{input:this.value})}.bind(this)),gform.types[this.type].setup.call(this),this.rows=[],this.fields=_.map(this.fields,(function(t){return t.type="hidden",t}))},get:function(){return this.multiple?_.transform(this.fields,function(t,e){t[e.name]=_.transform(this.el.querySelectorAll('[type="checkbox"][name="'+e.id+'"]:checked'),(function(t,e){t.push(e.value)}),[])}.bind(this),{}):_.transform(this.fields,function(t,e){t[e.name]=(this.el.querySelector('[type="radio"][name="'+e.id+'"]:checked')||{value:""}).value}.bind(this),{})},set:function(t){this.multiple?_.each(this.fields,function(t,e){if("undefinded"!=typeof this.limit&&null!=t&&t.length>this.limit)return!0;_.each(this.el.querySelectorAll('[name="'+e.id+'"][type=checkbox]'),function(t,e){e.checked=t.indexOf(e.value)>=0}.bind(this,t[e.name]))}.bind(this,t)):_.each(this.fields,function(e){var i=this.querySelector('[name="'+e.id+'"][value="'+t[e.name]+'"]');null!==i&&(i.checked="checked")}.bind(this)),this.value=t,gform.types.grid.setup.call(this)},focus:function(){this.el.querySelector('[name="'+this.fields[0].id+'"]').focus()}});
gform.processConditions=function(n,e){if("string"==typeof n&&("show"!==n&&"edit"!==n&&"parse"!==n||(n=this.item[n])),"boolean"==typeof n&&e.call(this,n),"function"==typeof n&&e.call(this,n.call(this)),"object"==typeof n){var t=function(n,e){e.call(this,gform._rules.call(this,n))}.bind(this,n,e);gform._subscribeByName.call(this,n,t)}return!0},gform._subscribeByName=function(n,e){for(var t in n)void 0!==n[t].name?this.owner.on("change:"+n[t].name,e):"object"==typeof n[t].conditions&&gform._subscribeByName.call(this,n[t].conditions,e)},gform._rules=function(n,e){e=e||"and";return _.reduce(n,function(n,t){var o;return void 0!==t.conditions?(o=gform._rules.call(this,t.conditions,t.op),console.log(o)):o=gform.conditions[t.type](this,t),"or"==e?n||o:n&&o}.bind(this),"and"==e)},gform.conditions={requires:function(n,e){return n.parent.find(e.name).satisfied()},not_matches:function(n,e){var t=e.value,o=(n.parent.find(e.name)||{value:""}).value;return"object"==typeof t&&null!==o?-1==t.indexOf(o):t!==o},test:function(n,e){return e.test.call(this,n,e)},contains:function(n,e){var t=e.value,o=n.parent.find(e.name),i=null;return void 0===o?"Target field "+e.name+" not found!":(i=0!=o.array?n.parent.find(e.name).parent.get()[e.name]:o.value,"object"!=typeof t||null===i?void 0!==i&&-1!==i.indexOf(t):"object"==typeof i?_.intersection(t,i).length>0:"string"==typeof i?_.some(t,(function(n){return i.indexOf(n)>=0})):void 0)},matches:function(n,e){var t=e.value,o=(n.parent.find(e.name)||{value:""}).value;return"object"==typeof t&&null!==o?-1!==t.indexOf(o):t==o}};
gform.prototype.errors={},gform.prototype.validate=function(e){return this.valid=!0,_.each(this.fields,gform.validateItem.bind(null,e)),this.valid?this.trigger("valid"):this.trigger("invalid",{errors:this.errors}),this.trigger("validation"),this.valid},gform.handleError=gform.update,gform.validateItem=function(e,r){var t=r.get();if((e||!r.valid||r.required||r.satisfied(t))&&(r.valid=!0,r.errors="",r.parsable&&"object"==typeof r.validate)){var a=gform.validation.call(r,r.validate);if(r.required){var i=!r.satisfied(r.get())&&"{{label}} is required";i&&a.push(gform.renderString(r.required.message||i,{label:r.label,value:t,args:r.required}))}a=_.compact(a),(void 0===r.display||r.visible)&&(r.valid=!a.length,r.errors=a.join("<br>"),gform.handleError(r))}r.parsable&&void 0!==r.fields&&_.each(r.fields,gform.validateItem.bind(null,e)),r.errors?r.owner.trigger("invalid:"+r.name,{errors:r.errors}):r.owner.trigger("valid:"+r.name),r.owner.errors[r.name]=r.errors,r.owner.valid=r.valid&&r.owner.valid},gform.validation=function(e,r){r=r||"and";var t=this.get(),a=_.map(e,function(e,r){if("string"==typeof r.type){if(void 0===r.conditions||gform._rules.call(this,r.conditions)){var a=e[r.type].call(this,t,r);if(a)return gform.renderString(r.message||a,{label:this.label,value:t,args:r})}}else if(void 0!==r.tests)return gform.validation.call(this,r.tests,r.op).join("<br>")}.bind(this,gform.validations));return"and"==r||_.compact(a).length==e.length?a:[]},gform.regex={numeric:/^[0-9]+$/,decimal:/^\-?[0-9]*\.?[0-9]+$/,url:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,email:/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i},gform.validations={none:function(e){return!1},required:function(e){return!this.satisfied(e)&&"{{label}} is required"},pattern:function(e,r){var t=r.regex;return"string"==typeof t&&(t=void 0!==gform.regex[t]?gform.regex[t]:new RegExp(jsonObject.regex,"i")),!t.pattern(e)&&""!==e&&r.message},custom:function(e,r){return r.test.call(this,e,r)},matches:function(e,r){var t=this.parent.find(r.name);return void 0===t?"Matching field not defined":(r.label=t.label,r.value=t.get(),e!=r.value&&'"{{label}}" does not match the "{{args.label}}" field')},date:function(e){return!gform.regex.date.test(e)&&""!==e&&"{{label}} should be in the format MM/DD/YYYY"},valid_url:function(e){return!gform.regex.url.test(e)&&""!==e&&"{{label}} must contain a valid Url"},valid_email:function(e){return!gform.regex.email.test(e)&&""!==e&&"{{label}} must contain a valid email address"},length:function(e,r){return gform.regex.numeric.test(r.max)||gform.regex.numeric.test(r.min)?"number"==typeof r.max&&"number"==typeof r.min&&r.min==r.max?r.min!=e.length&&"{{label}} must be exactly "+r.min+" characters in length":"number"==typeof r.max&&e.length>r.max?"{{label}} must not exceed "+r.max+" characters in length":"number"==typeof r.min&&e.length>0&&e.length<r.min&&"{{label}} must be at least "+r.min+" characters in length":"Invalid length requirement"},numeric:function(e,r){return gform.regex.decimal.test(e)||""===e?"number"==typeof r.min&&parseFloat(e)<parseFloat(r.min)?"{{label}} must contain a number greater than {{args.min}}":"number"==typeof r.max&&parseFloat(e)>parseFloat(r.max)?"{{label}} must contain a number less than {{args.max}}":void 0:"{{label}} must contain only numbers"}};
