var gform=function(e,t){"use strict";this.handlers=e.events||{},_.map(e.events,function(e,t){_.isArray(e)||(this.handlers[t]=[e])}.bind(this)),this.sub("reset",function(e){e.form.set(e.form.options.data)}),this.sub("clear",function(e){e.form.set()}),this.options=_.assignIn({legend:"",default:gform.default,data:"search",columns:gform.columns,name:gform.getUID()},this.opts,e),this.options.fields=this.options.fields.concat(this.options.actions||[]),"string"==typeof this.options.data&&(this.options.data=window.location[this.options.data].substr(1).split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e[t[0]]=decodeURIComponent(t[1]),e},{})),this.options.sections&&_.each(_.filter(this.options.fields,{type:"fieldset"}),function(e,t){return e.index=t,e.section=!0,e.id=gform.getUID(),e}),this.el=t||e.el,"string"==typeof this.el?this.el=document.querySelector(this.el):"object"==typeof this.el?this.el:t="",this.pub("initialize");var i=function(){void 0===this.el&&(this.options.renderer="modal",this.el=gform.create(gform.render(this.options.template||"modal_container",this.options)),gform.addClass(this.el,"active"),this.sub("close",function(e){e.form.modal("hide")}),this.sub("save",function(e){gform.removeClass(e.form.el,"active")}),this.el.querySelector(".close").addEventListener("click",function(e){this.pub("cancel",this)}.bind(this)),document.addEventListener("keyup",function(e){"Escape"===e.key&&this.pub("cancel",this)}.bind(this))),this.options.clear&&"modal"!=this.options.renderer&&(this.el.innerHTML=gform.render(this.options.sections+"_container",this.options)),this.container=this.el.querySelector("form")||this.el,this.rows={},this.fields=_.map(this.options.fields,gform.createField.bind(this,this,this.options.data||{},null,null)),_.each(this.fields,gform.inflate.bind(this,this.options.data||{})),gform.each.call(this,function(e){e.owner.pub("change:"+e.name,e)}),gform.instances[this.options.name]=this};this.restore=i.bind(this),this.get=this.toJSON=gform.toJSON.bind(this),this.reflow=gform.reflow.bind(this),this.find=gform.find.bind(this),this.set=function(e,t){"string"==typeof e&&this.find(e).set(t),"object"==typeof e&&_.each(e,function(e,t){var i=this.find(t);void 0!==i&&i.set(e)}.bind(this)),null==e&&gform.each.call(this,function(e){e.set("")})}.bind(this),this.isActive=!0,this.destroy=function(){this.pub(["close","destroy"]),this.el.innerHTML="",delete gform.instances[this.options.name],this.pub("destroyed")},i.call(this);var o=this.el.querySelector("ul.tabs");return null!==o&&o.addEventListener("click",function(e){"LI"==e.target.nodeName&&(e.preventDefault(),gform.removeClass(this.el.querySelector("ul.tabs .active"),"active"),gform.removeClass(this.el.querySelector(".tab-pane.active"),"active"),gform.addClass(e.target,"active"),gform.addClass(this.el.querySelector(e.target.parentElement.attributes.href.value),"active"))}.bind(this)),(this.options.autoFocus||gform.options.autoFocus)&&gform.types[this.fields[0].type].focus.call(this.fields[0]),this.el.addEventListener("click",function(e){var t;if(e.target.dataset.id&&(t=gform.findByID.call(this,e.target.dataset.id)),e.target.classList.contains("gform-add")){e.stopPropagation();var i=_.countBy(t.parent.fields,{name:t.name}).true;if(i<(t.array.max||5)){var o=_.findIndex(t.parent.fields,{id:t.id}),n=gform.createField.call(this,t.parent,{},t.el,null,t.item,null,null,i);t.parent.fields.splice(o+1,0,n),t.parent.reflow(),_.each(_.filter(t.parent.fields,{name:t.name}),function(e,t){e.index=t,e.label=gform.renderString(e.item.label,e),e.el.querySelector("legend,label").innerHTML=e.label}),gform.each.call(t.owner,function(e){e.owner.pub("change:"+e.name,e)}),gform.types[n.type].focus.call(n),t.owner.pub(["change","change:"+t.name,"create","create:"+t.name,"inserted","inserted:"+t.name],t)}}if(e.target.classList.contains("gform-minus"))if(e.stopPropagation(),_.countBy(t.parent.fields,{name:t.name}).true>(t.array.min||1)){o=_.findIndex(t.parent.fields,{id:t.id});t.parent.fields.splice(o,1),t.parent.reflow(),t.target?this.container.querySelector(t.target).removeChild(t.el):_.each(_.filter(t.parent.fields,{name:t.name}),function(e,t){e.index=t,e.label=gform.renderString(e.item.label,e),e.el.querySelector("label").innerHTML=e.label}),t.owner.pub(["change","change:"+t.name,"removed","removed:"+t.name],t)}else t.set(null)}.bind(this)),this};gform.each=function(e){_.each(this.fields,function(t){e(t),void 0!==t.fields&&gform.each.call(t,e)})},gform.find=function(e){var t=e.split("."),i=_.find(this.fields,{name:t.shift()});return void 0!==i?void 0!==i.find?i.name==e?i:i.find(t.join(".")):i:void 0!==this.parent&&"function"==typeof this.parent.find?this.parent.find(e):void 0},gform.findByID=function(e){var t=!1;return _.each(this.fields,function(i){i.id==e&&(t=i),t||void 0===i.fields||(t=gform.findByID.call(i,e))}),t},gform.toJSON=function(e){if("string"==typeof e&&e.length>0)return e=e.split("."),_.find(this.fields,{name:e.shift()}).get(e.join("."));var t={};return _.each(this.fields,function(e){e.parsable&&(e.array?(t[e.name]=t[e.name]||[],t[e.name].push(e.get())):t[e.name]=e.get())}.bind(this)),t},gform.m=function(e,t,i,o){function n(e,t){return e=e[(t=t.pop?t:t.split(".")).shift()]||"",0 in t?n(e,t):e}var s=gform.m,r="";t=_.isArray(t)?t:t?[t]:[],t=o?0 in t?[]:[1]:t;for(o=0;o<t.length;o++){var a,l="",p=0,f="object"==typeof t[o]?t[o]:{};(f=_.assign({},i,f))[""]={"":t[o]},e.replace(/([\s\S]*?)({{((\/)|(\^)|#)(.*?)}}|$)/g,function(e,t,i,o,d,c,u){p?l+=p&&!d||1<p?e:t:(r+=t.replace(/{{{(.*?)}}}|{{(!?)(&?)(>?)(.*?)}}/g,function(e,t,i,o,r,a){return t?n(f,t):o?n(f,a):r?s(n(f,a),f):i?"":new Option(n(f,a)).innerHTML}),a=c),d?--p||(u=n(f,u),r=/^f/.test(typeof u)?r+u.call(f,l,function(e){return s(e,f)}):r+s(l,u,f,a),l=""):++p})}return r},gform.reflow=function(){_.each(this.rows,function(e,t){this.container.removeChild(e.ref),delete this.rows[t]}.bind(this)),_.each(this.fields,function(e){if(e.columns>0){var t,i=e.parent.container.querySelectorAll("form > ."+e.owner.options.rowClass+",fieldset > ."+e.owner.options.rowClass);if(void 0!==(o=(i[i.length-1]||{}).id)&&(t=e.parent.rows[o]),void 0===t||t.used+parseInt(e.columns,10)+parseInt(e.offset,10)>e.owner.options.columns||1==e.row){var o=gform.getUID();(t={}).used=0,t.ref=document.createElement("div"),t.ref.setAttribute("id",o),t.ref.setAttribute("class",e.owner.options.rowClass),t.ref.setAttribute("style","margin-bottom:0;"),e.parent.rows[o]=t,e.parent.container.appendChild(t.ref)}t.used+=parseInt(e.columns,10),t.used+=parseInt(e.offset,10),t.ref.appendChild(e.el),e.row=o}})},gform.instances={},gform.inflate=function(e,t,i,o){var n=o;t.array&&(n=_.uniqBy(n,"name"));var s=_.findLast(n,{name:n[i].name});if(!s.array&&s.fields&&_.each(s.fields,gform.inflate.bind(this,e[s.name]||s.owner.options.data[s.name]||{})),s.array){var r=s.array.min||0;"object"!=typeof e[s.name]&&"object"==typeof s.owner.options.data[s.name]&&(e=s.owner.options.data),"object"==typeof e[s.name]&&e[s.name].length>1&&e[s.name].length>r&&(r=e[s.name].length);for(var a=1;a<r;a++){var l=gform.createField.call(this,s.parent,e,s.el,a,s.item,null,null,a);s.parent.fields.splice(_.findIndex(s.parent.fields,{id:s.id})+1,0,l),s=l}}},gform.normalizeField=function(e,t){t=t||null;e.type=e.type||this.options.default.type||"text";var i=_.assignIn({name:(gform.renderString(e.label)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:e.legend||e.name,validate:[],valid:!0,parsable:!0,visible:!0,enabled:!0,parent:t,array:!1,columns:this.options.columns||gform.columns,offset:0,ischild:!(t instanceof gform)},this.opts,gform.default,this.options.default,(gform.types[e.type]||gform.types.text).defaults,e);return""==i.name&&(i.name=i.id),i.item=_.extend(e,{}),i},gform.createField=function(e,t,i,o,n,s,r,a){var l=gform.normalizeField.call(this,n,e);if(l.owner=this,l.columns>this.options.columns&&(l.columns=this.options.columns),l.array&&"object"==typeof(t[l.name]||l.owner.options.data[l.name])?l.value=(t[l.name]||l.owner.options.data[l.name])[o||0]||{}:l.value=t[l.name]||l.owner.options.data[l.name]||l.value,0!==l.item.value?l.array&&"object"==typeof t[l.name]?l.value=t[l.name][o||0]:"function"==typeof l.item.value?(l.valueFunc=l.item.value,l.derivedValue=function(){return l.valueFunc.call(l,l.owner.toJSON())},l.item.value=l.item.value=l.derivedValue(),l.owner.sub("change",function(){this.set.call(this,this.derivedValue())}.bind(l))):l.value=t[l.name]||l.value||"":l.value=0,l.index=a||0,l.label=gform.renderString(l.item.label||l.label,l),l.satisfied=l.satisfied||gform.types[l.type].satisfied.bind(l),l.update=gform.types[l.type].update.bind(l),l.destroy=gform.types[l.type].destroy.bind(l),l.active=function(){return this.parent.active()&&this.enabled&&this.parsable&&this.visible},l.set=function(e,t){this.value==e&&null!=e||gform.types[this.type].set.call(this,e)||(this.value=e,t||this.owner.pub(["change:"+this.name,"change"],this))}.bind(l),l.get=l.get||gform.types[l.type].get.bind(l),l.render=l.render||gform.types[l.type].render.bind(l),l.el=gform.types[l.type].create.call(l),l.container=l.el.querySelector("fieldset")||l.el||null,void 0!==gform.types[l.type].reflow&&(l.reflow=gform.types[l.type].reflow.bind(l)||null),void 0!==gform.types[l.type].find&&(l.find=gform.types[l.type].find.bind(l)||null),l.target||l.section||!this.options.clear&&!l.isChild)l.target||(l.target='[name="'+l.name+'"],[data-inline="'+l.name+'"]'),null!=(d=this.el.querySelector(l.target))?d.appendChild(l.el):l.section&&l.owner.el.querySelector("."+l.owner.options.sections+"-content").appendChild(l.el);else if(l.columns>0){var p,f=l.parent.container.querySelectorAll("form > ."+l.owner.options.rowClass+",fieldset > ."+l.owner.options.rowClass);if(void 0!==(d=(f[f.length-1]||{}).id)&&(p=l.parent.rows[d]),void 0===p||p.used+parseInt(l.columns,10)+parseInt(l.offset,10)>this.options.columns||1==l.row){var d=gform.getUID();(p={}).used=0,p.ref=document.createElement("div"),p.ref.setAttribute("id",d),p.ref.setAttribute("class",l.owner.options.rowClass),p.ref.setAttribute("style","margin-bottom:0;"),l.parent.rows[d]=p,l.parent.container.appendChild(p.ref)}p.used+=parseInt(l.columns,10),p.used+=parseInt(l.offset,10),p.ref.appendChild(l.el),l.row=d}if(gform.types[l.type].initialize.call(l),l.fields){var c={};c=l.array&&"object"==typeof(t[l.name]||l.owner.options.data[l.name])?(t[l.name]||l.owner.options.data[l.name])[o||0]||{}:t[l.name]||l.owner.options.data[l.name]||{},l.fields=_.map(l.fields,gform.createField.bind(this,l,c,null,null)),l.array&&_.each(l.fields,gform.inflate.bind(this,c))}return gform.processConditions.call(l,l.display,function(e){this.el.style.display=e?"block":"none",this.visible=e}),gform.processConditions.call(l,l.enable,function(e){this.enabled=e,gform.types[this.type].enable.call(this,this.enabled)}),gform.processConditions.call(l,l.parse||l.display,function(e){this.parsable=e}),l.required&&gform.processConditions.call(l,l.required,function(e){this.required!==e&&this.update({required:e})}),l},gform.rows={add:function(e){var t=gform.getUID();return cRow={},cRow.used=0,cRow.ref=document.createElement("div"),cRow.ref.setAttribute("id",t),cRow.ref.setAttribute("class",this.options.rowClass),cRow.ref.setAttribute("style","margin-bottom:0;"),e.rows[t]=cRow,e.container.appendChild(cRow.ref),cRow},remove:function(){}},gform.ajax=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e.success(JSON.parse(t.responseText)):(console.log(t.responseText),e.error(t.responseText)))},t.open(e.verb||"GET",e.path),t.send()},gform.default={},gform.options={autoFocus:!0},gform.prototype.opts={clear:!0,sections:"",suffix:":",rowClass:"row",requiredText:'<span style="color:red">*</span>'},gform.prototype.sub=function(e,t){var i=e.split(" ");return"object"!=typeof this.handlers[e]&&(this.handlers[e]=[]),_.each(i,function(e){this.handlers[e].push(t)}.bind(this)),this},gform.prototype.on=gform.prototype.sub,gform.prototype.pub=function(e,t,i){(i=i||{}).form=this,void 0!==t&&(i.field=t);var o=[];return"string"==typeof e?o.push(e):o=o.concat(e),_.each(o,function(e,t){e.event=t;var i=function(t){t.call(null,e)}.bind(this);_.each(this.handlers[t],i),_.each(this.handlers["*"],i)}.bind(this,i)),this},gform.mapOptions=function(e,t,i){function o(e){return _.map(e,function(e){if("object"==typeof e&&"optgroup"==e.type)return e.map=new gform.mapOptions(e,t,i),e.map.sub("*",function(e){this.pub(e.event)}.bind(this)),e.id=gform.getUID(),gform.processConditions.call(this,e.enable,function(e,t){for(var i=this.el.querySelectorAll('[data-id="'+e+'"]'),o=0;o<i.length;o++)i[o].disabled=!t}.bind(this,e.id)),gform.processConditions.call(this,e.display,function(e,t){for(var i=this.el.querySelectorAll('[data-id="'+e+'"]'),o=0;o<i.length;o++)i[o].hidden=!t}.bind(this,e.id)),e;var o=_.extend({},e);return o.data=e,"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||(o.label=o.value=e),o.index=e.index||""+i,"undefined"!=typeof format&&(void 0!==format.label&&(o.label=gform.renderString(format.label,o)),void 0!==format.value&&(o.value=gform.renderString(format.value,o))),(o.value==t||this.multiple&&t.indexOf(o.value)>=0)&&(o.selected=!0),i+=1,o.i=i,o}.bind(this))}switch(this.handlers=[],this.optgroup=_.extend({},e),i=i||0,format=this.optgroup.format,this.optgroup.options=this.optgroup.options||[],typeof this.optgroup.options){case"string":this.optgroup.path=this.optgroup.path||this.optgroup.options,this.optgroup.options=[];break;case"function":this.optgroup.action=this.optgroup.options,this.optgroup.options=[]}if(void 0!==this.optgroup.max&&""!==this.optgroup.max)for(var n=this.optgroup.min||0;n<=this.optgroup.max;n+=this.optgroup.step||1)this.optgroup.options.push(""+n);return void 0!==this.optgroup.action&&(this.optgroup.options=this.optgroup.options.concat(o.call(this,this.optgroup.action.call(this)))),_.isArray(this.optgroup.options)&&(this.optgroup.options=o.call(this,this.optgroup.options)),void 0!==this.optgroup.path&&gform.ajax({path:this.optgroup.path,success:function(e){this.optgroup.options=o.call(this.optgroup.map,e),this.pub("change")}.bind(this)}),{getobject:function(){return _.map(this.optgroup.options,function(e){return void 0!==e.map?(e.options=e.map.getoptions(),{optgroup:{label:e.label||"",options:e.map.getoptions()}}):e})}.bind(this),getoptions:function(e){var t=[];return _.each(this.optgroup.options,function(e){void 0!==e.map?t=t.concat(e.map.getoptions()):t.push(e)}),void 0!==e?_.find(t,e):t}.bind(this),sub:this.on,pub:this.pub,handlers:this.handlers,optgroup:this.optgroup}},gform.mapOptions.prototype.on=gform.prototype.sub,gform.mapOptions.prototype.pub=gform.prototype.pub,gform.render=function(e,t){return gform.m(gform.stencils[e||"text"]||gform.stencils.text,_.extend({},gform.stencils,t))},gform.create=function(e){return document.createRange().createContextualFragment(e).firstElementChild},gform.renderString=function(e,t){return gform.m(e||"",t||{})},gform.addClass=function(e,t){e.className=_.chain(e.className).split(/[\s]+/).union(t.split(" ")).join(" ").value()},gform.removeClass=function(e,t){e.className=_.chain(e.className).split(/[\s]+/).difference(t.split(" ")).join(" ").value()},gform.VERSION="0.0.0.6",gform.i=0,gform.getUID=function(){return"f"+gform.i++};
gform.types={input:{defaults:{},setLabel:function(){this.label=gform.renderString(this.item.label||this.label,this);var t=this.el.querySelector("label");null!==t&&(t.innerHTML=this.label)},create:function(){var t=document.createElement("span");return t.setAttribute("id",this.id),this.owner.options.clear&&t.setAttribute("class",""+gform.columnClasses[this.columns]),t.innerHTML=this.render(),t},render:function(){return gform.render(this.type,this)},destroy:function(){this.el.removeEventListener("input",this.onchangeEvent)},initialize:function(){this.onchangeEvent=function(){if(this.input=!0,this.value=this.get(),null!=this.el.querySelector(".count")){var t=this.value.length;this.limit&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}this.owner.pub(["change:"+this.name,"change","input:"+this.name,"input"],this,{input:this.value})}.bind(this),this.input=this.input||!1,this.el.addEventListener("input",this.onchangeEvent.bind(null,!0))},update:function(t,e){void 0===t||void 0===typeof t.options&&void 0===typeof t.max&&void 0===typeof t.action||void 0===this.mapOptions||(delete this.mapOptions,this.item=_.defaults({},t,this.item),this.options=_.extend([],this.item.options),this.max=this.item.max,this.min=this.item.min,this.path=this.item.path,this.action=this.item.action),"object"==typeof t&&_.extend(t,this),this.label=gform.renderString((t||{}).label||this.item.label,this);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),e||this.owner.pub(["change:"+this.name,"change"],this),"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},get:function(){return this.el.querySelector('input[name="'+this.name+'"]').value},set:function(t){this.el.querySelector('input[name="'+this.name+'"]').value=t},satisfied:function(t){return void 0!==this.value&&null!==this.value&&""!==this.value},enable:function(t){this.el.querySelector('[name="'+this.name+'"]').disabled=!t},find:function(){return this},focus:function(){this.el.querySelector('[name="'+this.name+'"]').focus();var t=this.value;this.set(""),this.set(t)}},bool:{defaults:{options:[!1,!0],format:{label:""}},render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value),this.mapOptions.sub("change",function(){this.options=this.mapOptions.getobject(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.selected=this.value==this.options[1].value,gform.render(this.type,this)},set:function(t){this.selected=t==this.options[1].value,this.el.querySelector('input[name="'+this.name+'"]').checked=this.selected},get:function(){return this.options[this.el.querySelector('input[name="'+this.name+'"]').checked?1:0].value}},collection:{defaults:{format:{label:"{{label}}",value:"{{value}}"}},render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value),this.mapOptions.sub("change",function(){this.options=this.mapOptions.getobject(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),gform.render(this.type,this)},setup:function(){this.multiple&&"undefinded"!=typeof this.limit&&(this.value.length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelector("select").options,function(t){t.disabled=!t.selected})):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelector("select").options,function(t){t.disabled=!1}))),gform.types[this.type].setLabel.call(this)},initialize:function(){this.el.addEventListener("change",function(){if(this.input=!0,this.value=this.get(),null!=this.el.querySelector(".count")){var t=this.value.length;this.limit&&(t+="/"+this.limit),this.el.querySelector(".count").innerHTML=t}gform.types[this.type].setup.call(this),this.owner.pub(["change:"+this.name,"change","input:"+this.name,"input"],this,{input:this.value})}.bind(this)),this.input=this.input||!1,gform.types[this.type].setup.call(this)},get:function(){var t=this.el.querySelector("select").value;return this.multiple&&(t=_.transform(this.el.querySelector("select").options,function(t,e){e.selected&&t.push(e.value)},[])),t},set:function(t){if(this.el.querySelector("select").value=t,this.multiple&&_.isArray(t)){if("undefinded"!=typeof this.limit&&t.length>this.limit)return!0;_.each(this.el.querySelector("select").options,function(e){e.selected=t.indexOf(e.value)>=0}.bind(this))}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},focus:function(){this.el.querySelector('[name="'+this.name+'"]').focus()}},section:{create:function(){var t=document.createRange().createContextualFragment(this.render()).firstElementChild;return gform.addClass(t,gform.columnClasses[this.columns]),t},initialize:function(){this.rows={}},render:function(){return gform.render(this.owner.options.sections+"_fieldset",this)},update:function(t,e){"object"==typeof t&&_.extend(this.item,t),this.label=gform.renderString(({}||t).label||this.item.label,this);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this),this.container=this.el.querySelector("fieldset")||this.el||null,this.reflow(),e||this.owner.pub(["change:"+this.name,"change"],this)},get:function(t){return gform.toJSON.call(this,t)},set:function(t){null==t||""==t?gform.each.call(this,function(t){t.set("")}):_.each(t,function(t,e){var i=this.find(e);void 0!==i&&i.set(t)}.bind(this))},find:function(t){return gform.find.call(this,t)},reflow:function(){gform.reflow.call(this)},focus:function(){gform.types[this.fields[0].type].focus.call(this.fields[0])}},button:{defaults:{parsable:!1,columns:2,target:".gform-footer"},create:function(){var t=document.createRange().createContextualFragment(this.render()).firstElementChild;return t.setAttribute("id",this.id),t},initialize:function(){this.action=this.action||(this.label||"").toLowerCase().split(" ").join("_"),this.onclickEvent=function(){this.enabled&&this.owner.pub(this.action,this)}.bind(this),this.el.addEventListener("click",this.onclickEvent)},render:function(){return gform.render("button",this)},satisfied:function(t){return this.enabled&&this.visible},update:function(t,e){"object"==typeof t&&_.extend(this,this.item,t),this.label=gform.renderString(this.item.label,this);var i=this.el;this.destroy(),this.el=gform.types[this.type].create.call(this),i.parentNode.replaceChild(this.el,i),gform.types[this.type].initialize.call(this)},destroy:function(){this.el.removeEventListener("click",this.onclickEvent)},get:function(t){return null},set:function(t){},enable:function(t){this.el.disabled=!t}}},gform.types.text=gform.types.password=gform.types.number=gform.types.color=gform.types.input,gform.types.hidden=_.extend({},gform.types.input,{defaults:{columns:!1}}),gform.types.output=_.extend({},gform.types.input,{get:function(t){return this.el.querySelector("output").innerHTML},set:function(t){this.value=gform.renderString(t,this),this.el.querySelector("output").innerHTML=thisvalue}}),gform.types.email=_.extend(gform.types.input,{defaults:{validate:[{type:"valid_email"}]}}),gform.types.textarea=_.extend(gform.types.input,{set:function(t){this.el.querySelector('textarea[name="'+this.name+'"]').innerHTML=t},get:function(){return this.el.querySelector('textarea[name="'+this.name+'"]').value}}),gform.types.switch=gform.types.checkbox=_.extend({},gform.types.input,gform.types.bool,{default:{format:{label:""}}}),gform.types.fieldset=_.extend({},gform.types.input,gform.types.section),gform.types.select=_.extend(gform.types.input,gform.types.collection,{render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value),this.mapOptions.sub("change",function(){this.options=this.mapOptions.getobject(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),"string"==typeof this.placeholder&&this.options.unshift({label:this.placeholder,value:"",enabled:!1,visible:!1,selected:!0}),gform.render(this.type,this)}}),gform.types.range=_.extend({},gform.types.input,gform.types.collection,{get:function(){return(this.el.querySelector("[type=range]")||{value:""}).value},set:function(t){this.el.querySelector("[type=range]").value=t}}),gform.types.radio=_.extend({},gform.types.input,gform.types.collection,{setup:function(){this.multiple&&"undefinded"!=typeof this.limit&&(this.value.length>=this.limit?(this.maxSelected=!0,_.each(this.el.querySelectorAll("[type=checkbox]"),function(t){t.disabled=!t.checked})):this.maxSelected&&(this.maxSelected=!1,_.each(this.el.querySelectorAll("[type=checkbox]"),function(t){t.disabled=!1}))),gform.types[this.type].setLabel.call(this)},get:function(){return this.multiple?_.transform(this.el.querySelectorAll('[type="checkbox"]:checked'),function(t,e){t.push(e.value)},[]):(this.el.querySelector('[type="radio"]:checked')||{value:""}).value},set:function(t){if(this.multiple&&_.isArray(t)){if("undefinded"!=typeof this.limit&&t.length>this.limit)return!0;_.each(this.el.querySelectorAll("[type=checkbox]"),function(e){e.checked=t.indexOf(e.value)>=0}.bind(this))}else{var e=this.el.querySelector('[value="'+t+'"]');null!==e&&(e.checked="checked")}"function"==typeof gform.types[this.type].setup&&gform.types[this.type].setup.call(this)},enable:function(t){_.each(this.el.querySelectorAll("input"),function(e){e.disabled=!t})}}),gform.types.scale=_.extend({},gform.types.radio),gform.types.checkboxes=_.extend({},gform.types.radio,{multiple:!0}),gform.types.grid=_.extend({},gform.types.input,gform.types.collection,{render:function(){return void 0===this.mapOptions&&(this.mapOptions=new gform.mapOptions(this,this.value),this.mapOptions.sub("change",function(){this.options=this.mapOptions.getobject(),this.update()}.bind(this))),this.options=this.mapOptions.getobject(),this.fields=_.map(this.fields,function(t){return _.assignIn({name:(gform.renderString(t.label)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:t.name},t)}),gform.render(this.type,this)},setup:function(){this.multiple&&"undefinded"!=typeof this.limit&&_.each(this.fields,function(t){(this.value[t.name]||[]).length>=this.limit?(t.maxSelected=!0,_.each(this.el.querySelectorAll('[type=checkbox][name="'+t.id+'"]'),function(t){t.disabled=!t.checked})):t.maxSelected&&(t.maxSelected=!1,_.each(this.el.querySelectorAll('[type=checkbox][name="'+t.id+'"]'),function(t){t.disabled=!1}))}.bind(this)),gform.types[this.type].setLabel.call(this)},initialize:function(){this.el.addEventListener("change",function(){this.value=this.get(),gform.types[this.type].setup.call(this),this.owner.pub(["change:"+this.name,"change","input:"+this.name,"input"],this,{input:this.value})}.bind(this)),gform.types[this.type].setup.call(this),this.rows={},this.fields=_.map(this.fields,function(t){return t.type="hidden",t})},get:function(){return this.multiple?_.transform(this.fields,function(t,e){t[e.name]=_.transform(this.el.querySelectorAll('[type="checkbox"][name="'+e.id+'"]:checked'),function(t,e){t.push(e.value)},[])}.bind(this),{}):_.transform(this.fields,function(t,e){t[e.name]=(this.el.querySelector('[type="radio"][name="'+e.id+'"]:checked')||{value:""}).value}.bind(this),{})},set:function(t){this.multiple?_.each(this.fields,function(t,e){if("undefinded"!=typeof this.limit&&null!=t&&t.length>this.limit)return!0;_.each(this.el.querySelectorAll('[name="'+e.id+'"][type=checkbox]'),function(t,e){e.checked=t.indexOf(e.value)>=0}.bind(this,t[e.name]))}.bind(this,t)):_.each(this.fields,function(e){var i=this.querySelector('[name="'+e.id+'"][value="'+t[e.name]+'"]');null!==i&&(i.checked="checked")}.bind(this)),this.value=t,gform.types.grid.setup.call(this)},focus:function(){this.el.querySelector('[name="'+this.fields[0].id+'"]').focus()}});
gform.processConditions=function(n,e){if("string"==typeof n&&("display"!==n&&"enable"!==n&&"parse"!==n||(n=this.item[n])),"boolean"==typeof n&&e.call(this,n),"function"==typeof n&&e.call(this,n.call(this)),"object"==typeof n){var t=function(n,e){e.call(this,gform._rules.call(this,n))}.bind(this,n,e);gform._subscribeByName.call(this,n,t)}return!0},gform._subscribeByName=function(n,e){for(var t in n)void 0!==n[t].name?this.owner.sub("change:"+n[t].name,e):"object"==typeof n[t].conditions&&gform._subscribeByName.call(this,n[t].conditions,e)},gform._rules=function(n,e){e=e||"and";return _.reduce(n,function(n,t){var i;return void 0!==t.conditions?(i=gform._rules.call(this,t.conditions,t.op),console.log(i)):i=gform.conditions[t.type](this,t),"or"==e?n||i:n&&i}.bind(this),"and"==e)},gform.conditions={requires:function(n,e){return n.parent.find(e.name).satisfied()},not_matches:function(n,e){var t=e.value,i=(n.parent.find(e.name)||{value:""}).value;return"object"==typeof t&&null!==i?-1==t.indexOf(i):t!==i},test:function(n,e){return e.test.call(this,n,e)},contains:function(n,e){var t=e.value,i=(n.parent.find(e.name)||{value:""}).value;return"object"==typeof t&&null!==i?_.intersection(t,i).length>0:void 0!==i&&-1!==i.indexOf(t)},matches:function(n,e){var t=e.value,i=(n.parent.find(e.name)||{value:""}).value;return"object"==typeof t&&null!==i?-1!==t.indexOf(i):t==i}};
gform.prototype.errors={},gform.prototype.validate=function(e){return this.valid=!0,_.each(this.fields,gform.validateItem.bind(null,e)),this.valid?this.pub("valid"):this.pub("invalid",{errors:this.errors}),this.pub("validation"),this.valid},gform.handleError=gform.update,gform.validateItem=function(e,r){if(e||!r.valid||r.required||r.satisfied()){var t=r.get();if(r.valid=!0,r.errors="",r.parsable&&"object"==typeof r.validate){var a=gform.validation.call(r,r.validate);if(r.required){var i=!r.satisfied(t)&&"{{label}} is required";i&&a.push(gform.renderString(r.required.message||i,{label:r.label,value:t,args:r.required}))}a=_.compact(a),(void 0===r.display||r.visible)&&(r.valid=!a.length,r.errors=a.join("<br>"),gform.handleError(r)),void 0!==r.fields&&_.each(r.fields,gform.validateItem.bind(null,e))}r.errors?r.owner.pub("invalid:"+r.name,{errors:r.errors}):r.owner.pub("valid:"+r.name),r.owner.errors[r.name]=r.errors,r.owner.valid=r.valid&&r.owner.valid}},gform.validation=function(e,r){r=r||"and";var t=this.get(),a=_.map(e,function(e,r){if("string"==typeof r.type){if(void 0===r.conditions||gform._rules.call(this,r.conditions)){var a=e[r.type].call(this,t,r);if(a)return gform.renderString(r.message||a,{label:this.label,value:t,args:r})}}else if(void 0!==r.tests)return gform.validation.call(this,r.tests,r.op).join("<br>")}.bind(this,gform.validations));return"and"==r||_.compact(a).length==e.length?a:[]},gform.regex={numeric:/^[0-9]+$/,decimal:/^\-?[0-9]*\.?[0-9]+$/,url:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,date:/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,email:/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i},gform.validations={required:function(e){return!this.satisfied(e)&&"{{label}} is required"},pattern:function(e,r){var t=r.regex;return"string"==typeof t&&(t=gform.regex[t]),!t.pattern(e)&&""!==e&&r.message},custom:function(e,r){return r.test.call(this,e,r)},matches:function(e,r){var t=this.parent.find(r.name);return r.label=t.label,r.value=t.get(),void 0===t?"Matching field not defined":e!=r.value&&'"{{label}}" does not match the "{{args.label}}" field'},date:function(e){return!gform.regex.date.test(e)&&""!==e&&"{{label}} should be in the format MM/DD/YYYY"},valid_url:function(e){return!gform.regex.url.test(e)&&""!==e&&"{{label}} must contain a valid Url"},valid_email:function(e){return!gform.regex.email.test(e)&&""!==e&&"{{label}} must contain a valid email address"},length:function(e,r){return gform.regex.numeric.test(r.max)||gform.regex.numeric.test(r.min)?"number"==typeof r.max&&"number"==typeof r.min&&r.min==r.max?r.min!=e.length&&"{{label}} must be exactly "+r.min+" characters in length":"number"==typeof r.max&&e.length>r.max?"{{label}} must not exceed "+r.max+" characters in length":"number"==typeof r.min&&e.length>0&&e.length<r.min&&"{{label}} must be at least "+r.min+" characters in length":"Invalid length requirement"},numeric:function(e,r){return gform.regex.decimal.test(e)||""===e?"number"==typeof r.min&&parseFloat(e)<parseFloat(r.min)?"{{label}} must contain a number greater than {{args.min}}":"number"==typeof r.max&&parseFloat(e)>parseFloat(r.max)?"{{label}} must contain a number less than {{args.max}}":void 0:"{{label}} must contain only numbers"}};
