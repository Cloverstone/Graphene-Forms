<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Adam Smallcomb">
    <link rel="icon" href="../assets/favicon.png">

    <title>Example:Basic - Graphene:Forms</title>
    <link rel="stylesheet" href="../assets/css/normalize.css">    
    <link rel="stylesheet" href="../assets/css/gform.css">
  </head>
  <body>
    <div style="padding:20px">
    <h4><a href="./">Examples</a> - Options Array</h4>

    <div class="container ">
        <div class="row ">
                <div class="column" style="overflow: scroll;"><pre id="code"><code class="prettyprint"></code></pre></div>
                <div class="column column-40" style="overflow: scroll;"><pre id="code"><code class="prettyprint">var myForm = new gform(config, '#form');</code></pre><hr><div id="form"></div></div>
                <div class="column" style="overflow: scroll;"><pre id="result"><code class="prettyprint"></code></pre></div>
            </div>
        </div>
    </div>
    <script src="../assets/js/lodash.min.js"></script>    
    <script src='../assets/js/gform.js'></script>
    <!-- <script src='../assets/js/default.theme.min.js'></script> -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>            

    <script>
    // options = {
    //     legend: 'Options Array',
    //     fields:[
    //     {label: 'Select Field Array', name: 'array', type:'select', options:[
    //         {"label":"First","value":1},
    //         {"label":"Second","value":2},
    //         {"label":"Third","value":3}
    //     ]},       
    //     {label: 'Select Field Simple Array', name: 'simple', type:'select', options:[
    //         {type:"optgroup",options:['0','1','2']}
    //     ]},
    //     {label: 'Checkbox Simple Array', name: 'checkbox', type:'checkbox', options:[
    //         'no','yes'
    //     ]},
    //     {label: '<span style="color:{{value}}">Select Field function</span>',placeholder:'Choose a color', name: 'function', type:'select', options: function(){
    //         return["Red","Green","Blue"];
    //     }},
    //     {label: 'Select Field (url string)', name: 'url', type:'select', options:[{type:'optgroup', url:'../data/days.json'}]}
    //     ]
    // }

    // if(typeof opts.options == 'string' || typeof opts.url == 'string') {
    //     opts.path = opts.url || opts.options;
    //     opts.options = {label:'-'};
    //     opts.options[opts.path] = false;
    //     opts.url = null;
    //     gform.ajax({path: opts.path, success:function(data) {
    //         this.options = data;
    //         this.options = gform.mapOptions.call(this, this, this.value);
    //         this.update()
    //     }.bind(this)})
	// 	return opts;
    // }

    //{type:"optgroup",url:'',action:function(),options:[],max:1,min:1}
    gform.item = function(optgroup, value, count){
        this.optgroup = optgroup;
        count = count||0;
        format = optgroup.format;
        function pArray(opts){
            return _.map(opts,function(item){
                
                if(typeof item === 'object' && item.type == 'optgroup'){
                    item.map = new gform.mapOptions(item,value,count);
                    item.id = gform.getUID();
                    gform.processConditions.call(this, item.enable, function(id, result){
                        var op = this.el.querySelectorAll('[data-id="'+id+'"]');
                        for (var i = 0; i < op.length; i++) {
                            op[i].disabled = !result;
                        }
                    }.bind(this,item.id))            
                    gform.processConditions.call(this, item.display, function(id, result){
                        var op = this.el.querySelectorAll('[data-id="'+id+'"]');
                        for (var i = 0; i < op.length; i++) {
                            op[i].hidden = !result;
                        }
                    }.bind(this,item.id))
                    count += item.options.length;
                    return item;
                }else{
                    var option = {data:item};
                    if(typeof item === 'string' || typeof item === 'number' || typeof item == 'boolean') {
                        option.label = option.value = item;
                    }
                    option.index = item.index || ""+count;
                    if(typeof format !== 'undefined'){

                        if(typeof format.label !== 'undefined' ){
                            option.label = gform.renderString(format.label,option);
                        }
                        if(typeof format.value !== 'undefined' ){
                            option.value = gform.renderString(format.value,option);
                        }
                    }
                    if(option.value == value || (this.multiple && (value.indexOf(option.value)>=0) )) { option.selected = true;}
                    
                    count+=1;
                    option.i = count;
                    return option;
                }
            })
        }
        switch(typeof optgroup.options){
            case 'string':
                    optgroup.path = optgroup.path || optgroup.options;
                    optgroup.options = []
                    gform.ajax({path: optgroup.path, success:function(data) {
                        this.optgroup.options = pArray(data);
                        this.pub('change')
                    }.bind(this)})
            break;
            case 'function':
                optgroup.action = optgroup.options;
                optgroup.options = pArray(optgroup.action.call(this));
            break;
            default:
            if(_.isArray(optgroup.options)){
                optgroup.options = pArray(optgroup.options);
            }
        }

        return {getobject:function(){
            var temp = {};
            temp = _.map(this.optgroup.options,function(item){
                if(typeof item.map !== 'undefined'){
                    item.options = item.map.getoptions();
                    return {optgroup:{label:item.label||'',options:item.map.getoptions()}}
                }else{return item;}
            })
            return temp;
        }.bind(this),getoptions:function(search){
            var temp = [];
            _.each(this.optgroup.options,function(item){
                if(typeof item.map !== 'undefined'){
                    temp = temp.concat(item.map.getoptions())
                }else{temp.push(item)}
            })
            // debugger;
            if(typeof search !== 'undefined'){
                return _.find(temp,search)
            }
            return temp;
        }.bind(this),sub:this.on,pub:this.pub,handlers:this.handlers};
    }
    mapOptions.prototype.handlers = {initialize: []}
    mapOptions.prototype.on = gform.prototype.on;
    mapOptions.prototype.pub = gform.prototype.pub;



    // var test = new mapOptions({format:{label:"{{label}}",value:"{{index}}"} ,options:function(){return [3,4]}})
    // var test = new mapOptions({options:['1','2']})
    var test = new mapOptions({options:['hello',{type:'optgroup', options:'../data/days.json'}]})
    // var test = new mapOptions({options:'../data/days.json'})


    document.querySelector('#result code').classList = "prettyprint"
    document.querySelector('#result code').innerHTML = 'myform.get();<br> => '+JSON.stringify(test.getoptions(),null,2);
    PR.prettyPrint();
    test.sub('change',function(){
        document.querySelector('#result code').classList = "prettyprint"
        document.querySelector('#result code').innerHTML = 'myform.get();<br> => '+JSON.stringify(test.getoptions(),null,2);
        PR.prettyPrint();
    })
    </script>
   </body>
</html>